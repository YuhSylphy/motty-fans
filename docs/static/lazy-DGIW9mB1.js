import{q as v,d as P,r as D}from"./store-D5SVm-Xt.js";import{r as u,j as e,R as T}from"./jsx-runtime-_5WuVDLK.js";import{D as w}from"./datetime-BT3pVNmC.js";import{I as R,u as I,f as J,a as E,b as $,d as F}from"./base-Dytjuklp.js";import{i as z,k as U,j as g,u as V,_ as O,b as y,c as G,h as N}from"./DefaultPropsProvider-CSjmKMGg.js";import{P as L}from"./Paper-CR0QuJQc.js";import{C as W}from"./Container-C-BfI4Bx.js";import{T as q,G as m}from"./TextField-CLMaePN5.js";import{c as C}from"./menu-defs-CWIIiuKP.js";import{u as Q,a as M}from"./hooks-DVGqdmTD.js";import{a as Y}from"./List-Bzz6kMxx.js";import{T as K,D as X,a as Z,b as ee,c as H,d as h,e as se,A as te,L as ne}from"./TableRow-CK9a4Eab.js";import{T as l,L as ie}from"./ListItem-CO4yw9-0.js";import{I as re}from"./IconButton--QJhXQVt.js";import{B as oe}from"./Box-DH0NNVFk.js";import{L as le}from"./Link-BMnGLxO3.js";import{f as ae,w as ce}from"./util-HTIWu6Dw.js";import"./redux-toolkit.modern-J4jBE5Lh.js";import"./ducks-BgW1bLXP.js";import"./useFormControl-CkXjXPAx.js";import"./useTheme-BXk4qgwv.js";import"./useThemeProps-DPnKjH86.js";import"./resolveComponentProps-LjkoubKo.js";import"./utils-Ds4Qqy87.js";import"./TransitionGroupContext-OigCRaz6.js";import"./index-CTAOeIM6.js";import"./useSlotProps-BWWNHuKW.js";import"./Modal-x9pmWsIV.js";import"./Backdrop-Diuy1ohG.js";import"./GlobalStyles-CG4ksUWf.js";import"./createBox-gRr0yNN2.js";import"./of-P7tEz52u.js";function de(s){return z("MuiTableHead",s)}U("MuiTableHead",["root"]);const ue=["className","component"],me=s=>{const{classes:t}=s;return N({root:["root"]},de,t)},he=g("thead",{name:"MuiTableHead",slot:"Root",overridesResolver:(s,t)=>t.root})({display:"table-header-group"}),xe={variant:"head"},S="thead",pe=u.forwardRef(function(t,r){const i=V({props:t,name:"MuiTableHead"}),{className:o,component:a=S}=i,c=O(i,ue),n=y({},i,{component:a}),x=me(n);return e.jsx(K.Provider,{value:xe,children:e.jsx(he,y({as:a,className:G(x.root,o),ref:r,role:a===S?null:"rowgroup",ownerState:n},c))})}),je=C(e.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link"),fe=C(e.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),be=["video","broadcast","short"];function ve(s){return!!s&&be.includes(s)}function ge(s){if(!ve(s))return null;switch(s){case"video":return"動画";case"broadcast":return"生配信";case"short":return"ショート";default:throw Error(s)}}function k(){return e.jsx("div",{children:"Loading..."})}const B=s=>["★".repeat(s),"☆".repeat(5-s)].join("").trim(),Le=g("img")(s=>({objectFit:"cover"}));function _({thumbnail:{url:s,width:t,height:r},href:i,alt:o}){const a=I({xs:n=>({maxHeight:n.spacing(9)}),sm:n=>({maxHeight:n.spacing(9)}),md:n=>({maxHeight:n.spacing(6)}),lg:n=>({maxHeight:n.spacing(6)}),xl:n=>({maxHeight:n.spacing(6)})}),c=u.useMemo(()=>`${t} / ${r}`,[t,r]);return e.jsx(le,{href:i,sx:n=>({width:"100%",height:"100%",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",alignContent:"center",...a(n)}),target:"_blank",rel:"noopener noreferrer",children:e.jsx(Le,{sx:{aspectRatio:c},alt:o,src:s})})}function A(s){const t=s.map(ge);switch(t.length){case 0:return null;case 1:return t[0];default:return t.map(r=>r==null?void 0:r.slice(0,1)).join(" / ")}}const ye=({styles:s,masteryLevel:t,part1:r,href:i})=>{const o=u.useMemo(()=>A(s),[s]),a=u.useMemo(()=>B(t),[t]),c=i!==null?{href:i,target:"_blank",rel:"noopener noreferrer"}:r!==null&&r.url!=null?{href:r.url,target:"_blank",rel:"noopener noreferrer"}:{};return{liveStyleLabel:o,masteryLevelLabel:a,iconButtonAdditionalProps:c}};function Se({id:s,platform:t,title:r,titleReleasedIn:i,styles:o,amount:a,masteryLevel:c,part1:n,remarks:x,href:d}){const{liveStyleLabel:p,masteryLevelLabel:f,iconButtonAdditionalProps:j}=ye({styles:o,masteryLevel:c,part1:n,href:d}),b=u.useCallback(()=>e.jsxs(m,{container:!0,children:[e.jsx(m,{item:!0,xs:6,children:e.jsx(l,{children:p})}),e.jsx(m,{item:!0,xs:6,children:e.jsx(l,{children:f})}),e.jsx(m,{item:!0,xs:6,children:e.jsx(l,{children:t})}),e.jsx(m,{item:!0,xs:6,children:e.jsxs(l,{children:["実況: ",(n==null?void 0:n.publishedIn)??"(未設定)"]})}),e.jsx(m,{item:!0,xs:6,children:e.jsxs(l,{children:["配信数: ",a]})}),e.jsx(m,{item:!0,xs:6,children:e.jsxs(l,{children:["発売: ",i??"(未設定)"]})}),e.jsx(m,{item:!0,xs:12,children:e.jsx(l,{children:x})})]}),[p,f,t,n==null?void 0:n.publishedIn,a,i,x]);return e.jsx(ie,{secondaryAction:e.jsx(re,{edge:"end",...j,children:e.jsx(je,{})}),children:e.jsxs(m,{container:!0,children:[e.jsx(m,{item:!0,xs:12,children:e.jsx(ne,{primary:r})}),e.jsx(m,{item:!0,xs:4,children:n==null||!j.href?e.jsx(oe,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:e.jsx(l,{children:"(未設定)"})}):e.jsx(_,{thumbnail:n.thumbnail,alt:n.title,...j})}),e.jsx(m,{item:!0,xs:8,children:e.jsx(b,{})})]})},s)}function Te({defs:s}){return e.jsx(L,{children:e.jsx(Y,{sx:{width:"100%"},children:s.map(Se).flatMap((t,r)=>r===0?[t]:[e.jsx(X,{variant:"inset",component:"li",sx:{marginLeft:0}},`divider-${r}`),t])})})}function we({id:s,platform:t,title:r,titleReleasedIn:i,styles:o,amount:a,masteryLevel:c,part1:n,remarks:x,href:d},p){const f=u.useMemo(()=>A(o),[o]),j=u.useCallback(()=>n?e.jsx(h,{align:"center",sx:b=>({padding:`${b.spacing(.5)} ${b.spacing(2)}`}),children:e.jsx(_,{thumbnail:n.thumbnail,alt:r,href:d||n.url})}):e.jsx(h,{align:"center",children:e.jsx(l,{children:"(未設定)"})}),[n,r,d]);return e.jsxs(H,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(h,{component:"th",scope:"row",align:"center",children:e.jsx(l,{children:p+1})}),e.jsx(j,{}),e.jsx(h,{align:"center",children:e.jsx(l,{children:t})}),e.jsx(h,{children:e.jsx(l,{children:r})}),e.jsx(h,{align:"center",children:e.jsx(l,{children:(n==null?void 0:n.publishedIn)??"(未設定)"})}),e.jsx(h,{align:"center",children:e.jsx(l,{children:i??"(未設定)"})}),e.jsx(h,{align:"center",children:e.jsx(l,{children:f})}),e.jsx(h,{align:"center",children:e.jsx(l,{children:a})}),e.jsx(h,{align:"center",children:e.jsx(l,{children:B(c)})}),e.jsx(h,{children:e.jsx(l,{children:x})})]},s)}function Ie({defs:s}){return e.jsx(Z,{component:L,children:e.jsxs(ee,{"aria-label":"simple table",children:[e.jsx(pe,{children:e.jsx(H,{children:["#","Part 1.","機種","タイトル","実況年","発売年","実況形式","実況本数","やりこみ評価","備考"].map((t,r)=>e.jsx(h,{component:"th",scope:"row",align:"center",children:t},r))})}),e.jsx(se,{children:s.map(we)})]})})}function Ce(){return e.jsx(te,{position:"static",color:"primary",enableColorOnDark:!0,children:e.jsx(l,{variant:"subtitle1",children:"MOTTYのゲーム実況シリーズ一覧"})})}const Me=()=>{const{series:s}=M(i=>i.liveSeries),t=u.useMemo(()=>s.map(({id:i,game:o,seriesTitle:a,lives:c,remarks:n,videosHash:x})=>({id:i,platform:o==null?void 0:o.platform,title:a,titleReleasedIn:(o==null?void 0:o.releasedIn)||null,styles:(d=>Array.from(d))(c.map(({liveStyle:d})=>d).reduce((d,p)=>d.add(p),new Set)),amount:c.length,masteryLevel:o==null?void 0:o.masteryLevel,part1:c.length===0?null:c.slice(0,1).map(({publishedAt:d,url:p,thumbnail:f,title:j})=>({publishedIn:w.fromMillis(d,{zone:"JST"}).year,url:p,thumbnail:f,title:j}))[0],remarks:n,href:x?`/motty-fans/videos/${x}`:null})),[s]);return{viewMode:I({xs:"list",sm:"list",md:"table",lg:"table",xl:"table"}),defs:t}};function He(){const{viewMode:s,defs:t}=Me(),r=u.useCallback(()=>{switch(s){case"list":return e.jsx(Te,{defs:t});case"table":return e.jsx(Ie,{defs:t});default:throw s}},[s,t]);return e.jsxs(T.Fragment,{children:[e.jsx(Ce,{}),e.jsx(r,{})]})}const ke=g(L)(({theme:s})=>({marginTop:s.spacing(1),marginBottom:s.spacing(1),padding:s.spacing(1)}));function Be(){return e.jsx(W,{children:e.jsx(ke,{children:e.jsx(q,{id:"live-series-condition-input",label:"find",InputProps:{startAdornment:e.jsx(R,{position:"start",children:e.jsx(fe,{})})},variant:"standard",fullWidth:!0})})})}const _e=()=>{const[s,t]=u.useState(!1),r=Q();u.useEffect(()=>{s||(r(v.init()),t(!0))},[s,t,r]);const{series:i}=M(a=>a.liveSeries);return{loading:u.useMemo(()=>!i||i.length===0,[i])}};function Ae(){const{loading:s}=_e();return s?e.jsx(k,{}):e.jsxs(T.Fragment,{children:[e.jsx(Be,{}),e.jsx(He,{})]})}function js(){return e.jsx(u.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(Ae,{})})}const Pe=({id:{videoId:s},snippet:{description:t,publishedAt:r,title:i,thumbnails:o},liveSeriesId:a,liveStyle:c,tags:n},x,d)=>({id:s,description:t,publishedAt:w.fromISO(r).toMillis(),title:i,thumbnail:o.default,liveSeriesId:a,liveStyle:c,tags:(n==null?void 0:n.map(F("none")))??[],url:`https://www.youtube.com/watch?v=${s}`});async function De(){const[s,t,r]=await Promise.all([(async()=>{const i=await J();return Object.groupBy(i.items.filter(({liveSeriesId:o})=>o!=null).map(Pe),({liveSeriesId:o})=>o??(()=>{throw new Error("unexpected video record having no live-series id")})())})(),(async()=>(await E()).items)(),(async()=>{const i=await $();return new Map(i.items.map(o=>[o.id,o]))})()]);return t.map(i=>({...i,lives:i.id in s?s[i.id]??[]:[],game:i.gameId&&r.has(i.gameId)?r.get(i.gameId)??null:null}))}const Re=s=>s.pipe(ae(v.init.match),ce("live-series/init",async()=>{const t=await De();return v.setSeries({series:t})})),Je=P(Re);D(Je);export{js as default};
