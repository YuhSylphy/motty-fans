{"version":3,"file":"static/js/mare-line.339e513d.chunk.js","mappings":"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","sources":["features/horse-defs/core/epic.ts","features/mare-line/components/MareLineTree.tsx","features/mare-line/components/MareLine.tsx","features/mare-line/lazy.ts"],"sourcesContent":["import { combineEpics } from 'redux-observable';\r\nimport { filter } from 'rxjs/operators';\r\n\r\nimport type { Epic } from 'src/app';\r\nimport { withIndicator } from 'src/util';\r\n\r\nimport { horseDefsActions } from '..';\r\nimport { fetchHorseDefs } from './horse';\r\n\r\nexport const fetchDefsEpic: Epic = (action$) =>\r\n\taction$.pipe(\r\n\t\tfilter(horseDefsActions.init.match),\r\n\t\twithIndicator('horse-defs/fetch', async () =>\r\n\t\t\thorseDefsActions.set({ list: await fetchHorseDefs() })\r\n\t\t)\r\n\t);\r\n\r\nexport const epic = combineEpics(fetchDefsEpic);\r\n","import { IconButton } from '@mui/material';\nimport { TreeItem, TreeView } from '@mui/lab';\nimport { styled } from '@mui/material/styles';\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore';\nimport ChevronRightIcon from '@mui/icons-material/ChevronRight';\nimport RemoveIcon from '@mui/icons-material/Remove';\nimport InfoOutlinedIcon from '@mui/icons-material/InfoOutlined';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faMars, faQuestion, faVenus } from '@fortawesome/free-solid-svg-icons';\nimport React, { useEffect, useMemo, useState } from 'react';\n\nimport { useAppDispatch, useAppSelector, withIndicatorSync } from 'src/util';\n\nimport { HorseDef } from 'src/features/horse-defs';\nimport { pedigreeActions } from 'src/features/pedigree';\n\ntype Datum = {\n\tid: string;\n\tlabel: JSX.Element;\n\tclassName?: string;\n\tchildren: Datum[];\n\tfatherName?: string;\n\tmotherName?: string;\n\towned: boolean;\n};\n\nconst StyledTreeView = styled(TreeView)(({ theme }) => ({\n\t'& .name': {\n\t\tmarginLeft: theme.spacing(0.5),\n\t},\n\t'& .father': {\n\t\tmarginLeft: theme.spacing(1),\n\t},\n\t'& .male': {\n\t\tcolor: '#2196f3',\n\t},\n\t'& .female': {\n\t\tcolor: '#f44336',\n\t},\n\t'& .unknown': {\n\t\tcolor: '#888888',\n\t},\n}));\n\nconst InformationIcon: React.FC<{ name: string }> = ({ name }) => {\n\tconst dispatch = useAppDispatch();\n\tconst handleClick = useMemo(\n\t\t() => () => {\n\t\t\tdispatch(pedigreeActions.push(name));\n\t\t},\n\t\t[dispatch, name]\n\t);\n\n\treturn (\n\t\t<IconButton aria-label=\"horse info\" size=\"small\" onClick={handleClick}>\n\t\t\t<InfoOutlinedIcon fontSize=\"inherit\" />\n\t\t</IconButton>\n\t);\n};\n\nconst setNodeProperty = (node: Datum, def: HorseDef) => {\n\tnode.owned = node.owned || def.owned;\n\tnode.className = [def.sex].join(' ');\n\tnode.label = (\n\t\t<React.Fragment>\n\t\t\t{(() => {\n\t\t\t\tswitch (def.sex) {\n\t\t\t\t\tcase 'male':\n\t\t\t\t\t\treturn <FontAwesomeIcon icon={faMars} />;\n\t\t\t\t\tcase 'female':\n\t\t\t\t\t\treturn <FontAwesomeIcon icon={faVenus} />;\n\t\t\t\t\tcase 'unknown':\n\t\t\t\t\t\treturn <FontAwesomeIcon icon={faQuestion} />;\n\t\t\t\t\tdefault: {\n\t\t\t\t\t\tconst __exhaust: never = def.sex; // eslint-disable-line @typescript-eslint/no-unused-vars\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})()}\n\t\t\t<span className=\"name\">\n\t\t\t\t{def.name}\n\t\t\t\t<InformationIcon name={def.name} />\n\t\t\t</span>\n\t\t\t{def.fatherName ? (\n\t\t\t\t<React.Fragment>\n\t\t\t\t\t(\n\t\t\t\t\t<span className=\"father male\">\n\t\t\t\t\t\t{def.fatherName}\n\t\t\t\t\t\t<InformationIcon name={def.fatherName} />\n\t\t\t\t\t</span>\n\t\t\t\t\t)\n\t\t\t\t</React.Fragment>\n\t\t\t) : null}\n\t\t</React.Fragment>\n\t);\n\tnode.fatherName = def.fatherName ?? node.fatherName;\n\tnode.motherName = def.motherName ?? node.fatherName;\n};\n\nconst construct = (defs: HorseDef[]): { nodes: Datum[]; ids: string[] } => {\n\tconst map = new Map<string, Datum>();\n\n\tconst fetchOrCreateNode = (id: string) =>\n\t\tmap.get(id) ??\n\t\t(() => {\n\t\t\t// 新規\n\t\t\tconst created: Datum = {\n\t\t\t\tid,\n\t\t\t\tlabel: <React.Fragment />,\n\t\t\t\tchildren: [],\n\t\t\t\towned: false,\n\t\t\t};\n\t\t\tmap.set(id, created);\n\t\t\treturn created;\n\t\t})();\n\n\tconst append = (def: HorseDef) => {\n\t\tconst node = fetchOrCreateNode(def.name);\n\n\t\tsetNodeProperty(node, def);\n\n\t\tif (def.motherName) {\n\t\t\tconst mother = fetchOrCreateNode(def.motherName);\n\t\t\tmother.children.push(node);\n\t\t}\n\t};\n\n\tdefs.forEach(append);\n\treturn {\n\t\tnodes: Array.from(map.values()).filter(\n\t\t\t(value) =>\n\t\t\t\t// 所有馬であることは絶対条件\n\t\t\t\tvalue.owned &&\n\t\t\t\t// 母の名前がわからないか\n\t\t\t\t(!value.motherName ||\n\t\t\t\t\t// 母が登録されていないか\n\t\t\t\t\t!map.has(value.motherName) ||\n\t\t\t\t\t// 母はいるけど所有馬でないか\n\t\t\t\t\t(map.has(value.motherName) && !map.get(value.motherName)?.owned))\n\t\t),\n\t\tids: Array.from(map.keys()),\n\t};\n};\n\ntype MareLineTreeNodeProps = {\n\tnode: Datum;\n\ttoggleExpand: (node: Datum) => React.MouseEventHandler;\n};\n\nfunction MareLineTreeNode({ node, toggleExpand }: MareLineTreeNodeProps) {\n\tconst onIconClick = toggleExpand(node);\n\treturn (\n\t\t<TreeItem\n\t\t\tclassName={node.className}\n\t\t\tkey={node.id}\n\t\t\tnodeId={node.id}\n\t\t\tlabel={node.label}\n\t\t\tcollapseIcon={<ExpandMoreIcon onClick={onIconClick} />}\n\t\t\texpandIcon={<ChevronRightIcon onClick={onIconClick} />}\n\t\t\tendIcon={<RemoveIcon />}\n\t\t>\n\t\t\t{node.children\n\t\t\t\t.map((node) => ({ node, toggleExpand }))\n\t\t\t\t.map(MareLineTreeNode)}\n\t\t</TreeItem>\n\t);\n}\n\nexport const MareLineTree: React.FC = function MareLineTree() {\n\tconst dispatch = useAppDispatch();\n\tconst [expanded, setExpanded] = useState<string[]>([]);\n\n\tconst defs = useAppSelector((state) => state.horseDefs.list);\n\tconst { nodes, ids } = useMemo(() => {\n\t\tif (defs.length > 0) {\n\t\t\treturn withIndicatorSync(dispatch)('mare-line/init')(() =>\n\t\t\t\tconstruct(defs)\n\t\t\t);\n\t\t} else {\n\t\t\treturn { nodes: [], ids: [] };\n\t\t}\n\t}, [dispatch, defs]);\n\n\tuseEffect(() => {\n\t\tsetExpanded(ids);\n\t}, [setExpanded, ids]);\n\n\tconst toggleExpand = useMemo<(node: Datum) => React.MouseEventHandler>(\n\t\t() => (node) => (_event) => {\n\t\t\tsetExpanded(\n\t\t\t\texpanded.includes(node.id)\n\t\t\t\t\t? expanded.filter((id) => id !== node.id)\n\t\t\t\t\t: [...expanded, node.id]\n\t\t\t);\n\t\t},\n\t\t[expanded, setExpanded]\n\t);\n\n\treturn (\n\t\t<StyledTreeView\n\t\t\texpanded={expanded}\n\t\t\tdefaultCollapseIcon={<ExpandMoreIcon />}\n\t\t\tdefaultExpandIcon={<ChevronRightIcon />}\n\t\t\tdefaultEndIcon={<RemoveIcon />}\n\t\t>\n\t\t\t{nodes.map((node) => ({ node, toggleExpand })).map(MareLineTreeNode)}\n\t\t</StyledTreeView>\n\t);\n};\n","import React from 'react';\nimport { Paper } from '@mui/material';\nimport { styled } from '@mui/material/styles';\n\nimport { HorseDefsContainer } from 'src/features/horse-defs';\n\nimport { MareLineTree } from './MareLineTree';\n\nconst StyledPaper = styled(Paper)(({ theme }) => ({\n\tpadding: theme.spacing(2),\n}));\n\nexport function MareLine() {\n\treturn (\n\t\t<HorseDefsContainer>\n\t\t\t<StyledPaper>\n\t\t\t\t<MareLineTree />\n\t\t\t</StyledPaper>\n\t\t</HorseDefsContainer>\n\t);\n}\n","import { registerEpic } from 'src/app';\nimport { MareLine } from './components/MareLine';\nimport { epic } from 'src/features/horse-defs/core/epic';\n\nregisterEpic(epic);\n\nexport default MareLine;\n"],"names":["epic","combineEpics","action$","pipe","filter","horseDefsActions","withIndicator","fetchHorseDefs","list","set","StyledTreeView","styled","TreeView","theme","marginLeft","spacing","color","InformationIcon","name","dispatch","useAppDispatch","handleClick","useMemo","pedigreeActions","IconButton","size","onClick","InfoOutlined","fontSize","construct","defs","map","Map","fetchOrCreateNode","id","get","created","label","children","owned","forEach","def","node","className","sex","join","icon","faMars","faVenus","faQuestion","fatherName","motherName","setNodeProperty","push","nodes","Array","from","values","value","has","ids","keys","MareLineTreeNode","toggleExpand","onIconClick","TreeItem","nodeId","collapseIcon","ExpandMore","expandIcon","ChevronRight","endIcon","Remove","MareLineTree","useState","expanded","setExpanded","useAppSelector","state","horseDefs","length","withIndicatorSync","useEffect","_event","includes","defaultCollapseIcon","defaultExpandIcon","defaultEndIcon","StyledPaper","Paper","padding","registerEpic"],"sourceRoot":""}