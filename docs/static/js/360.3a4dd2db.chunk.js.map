{"version":3,"file":"static/js/360.3a4dd2db.chunk.js","mappings":"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","sources":["features/mare-line/components/MareLineTree.tsx","features/mare-line/components/MareLine.tsx"],"sourcesContent":["import { makeStyles, createStyles, Theme, IconButton } from '@material-ui/core';\nimport { TreeItem, TreeView } from '@material-ui/lab';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\nimport RemoveIcon from '@material-ui/icons/Remove';\nimport InfoOutlinedIcon from '@material-ui/icons/InfoOutlined';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faMars, faQuestion, faVenus } from '@fortawesome/free-solid-svg-icons';\nimport * as React from 'react';\nimport { useEffect, useMemo, useState } from 'react';\n\nimport { useAppDispatch, useAppSelector, withIndicatorSync } from 'src/util';\n\nimport { HorseDef } from 'src/features/horse-defs';\nimport { pedigreeActions } from 'src/features/pedigree';\n\ntype Datum = {\n\tid: string;\n\tlabel: JSX.Element;\n\tclassName?: string;\n\tchildren: Datum[];\n\tfatherName?: string;\n\tmotherName?: string;\n\towned: boolean;\n};\n\nconst useStyles = makeStyles((theme: Theme) =>\n\tcreateStyles({\n\t\troot: {\n\t\t\t'& .name': {\n\t\t\t\tmarginLeft: theme.spacing(0.5),\n\t\t\t},\n\t\t\t'& .father': {\n\t\t\t\tmarginLeft: theme.spacing(1),\n\t\t\t},\n\t\t\t'& .male': {\n\t\t\t\tcolor: '#2196f3',\n\t\t\t},\n\t\t\t'& .female': {\n\t\t\t\tcolor: '#f44336',\n\t\t\t},\n\t\t\t'& .unknown': {\n\t\t\t\tcolor: '#888888',\n\t\t\t},\n\t\t},\n\t})\n);\n\nconst InformationIcon: React.FC<{ name: string }> = ({ name }) => {\n\tconst dispatch = useAppDispatch();\n\tconst handleClick = useMemo(\n\t\t() => () => {\n\t\t\tdispatch(pedigreeActions.push(name));\n\t\t},\n\t\t[dispatch, name]\n\t);\n\n\treturn (\n\t\t<IconButton aria-label=\"horse info\" size=\"small\" onClick={handleClick}>\n\t\t\t<InfoOutlinedIcon fontSize=\"inherit\" />\n\t\t</IconButton>\n\t);\n};\n\nconst setNodeProperty = (node: Datum, def: HorseDef) => {\n\tnode.owned = node.owned || def.owned;\n\tnode.className = [def.sex].join(' ');\n\tnode.label = (\n\t\t<React.Fragment>\n\t\t\t{(() => {\n\t\t\t\tswitch (def.sex) {\n\t\t\t\t\tcase 'male':\n\t\t\t\t\t\treturn <FontAwesomeIcon icon={faMars} />;\n\t\t\t\t\tcase 'female':\n\t\t\t\t\t\treturn <FontAwesomeIcon icon={faVenus} />;\n\t\t\t\t\tcase 'unknown':\n\t\t\t\t\t\treturn <FontAwesomeIcon icon={faQuestion} />;\n\t\t\t\t\tdefault: {\n\t\t\t\t\t\tconst __exhaust: never = def.sex; // eslint-disable-line @typescript-eslint/no-unused-vars\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})()}\n\t\t\t<span className=\"name\">\n\t\t\t\t{def.name}\n\t\t\t\t<InformationIcon name={def.name} />\n\t\t\t</span>\n\t\t\t{def.fatherName ? (\n\t\t\t\t<React.Fragment>\n\t\t\t\t\t(\n\t\t\t\t\t<span className=\"father male\">\n\t\t\t\t\t\t{def.fatherName}\n\t\t\t\t\t\t<InformationIcon name={def.fatherName} />\n\t\t\t\t\t</span>\n\t\t\t\t\t)\n\t\t\t\t</React.Fragment>\n\t\t\t) : null}\n\t\t</React.Fragment>\n\t);\n\tnode.fatherName = def.fatherName ?? node.fatherName;\n\tnode.motherName = def.motherName ?? node.fatherName;\n};\n\nconst construct = (defs: HorseDef[]): { nodes: Datum[]; ids: string[] } => {\n\tconst map = new Map<string, Datum>();\n\n\tconst fetchOrCreateNode = (id: string) =>\n\t\tmap.get(id) ??\n\t\t(() => {\n\t\t\t// 新規\n\t\t\tconst created: Datum = {\n\t\t\t\tid,\n\t\t\t\tlabel: <React.Fragment />,\n\t\t\t\tchildren: [],\n\t\t\t\towned: false,\n\t\t\t};\n\t\t\tmap.set(id, created);\n\t\t\treturn created;\n\t\t})();\n\n\tconst append = (def: HorseDef) => {\n\t\tconst node = fetchOrCreateNode(def.name);\n\n\t\tsetNodeProperty(node, def);\n\n\t\tif (def.motherName) {\n\t\t\tconst mother = fetchOrCreateNode(def.motherName);\n\t\t\tmother.children.push(node);\n\t\t}\n\t};\n\n\tdefs.forEach(append);\n\treturn {\n\t\tnodes: Array.from(map.values()).filter(\n\t\t\t(value) =>\n\t\t\t\t// 所有場であることは絶対条件\n\t\t\t\tvalue.owned &&\n\t\t\t\t// 母の名前がわからないか\n\t\t\t\t(!value.motherName ||\n\t\t\t\t\t// 母が登録されていないか\n\t\t\t\t\t!map.has(value.motherName) ||\n\t\t\t\t\t// 母はいるけど所有場でないか\n\t\t\t\t\t(map.has(value.motherName) && !map.get(value.motherName)?.owned))\n\t\t),\n\t\tids: Array.from(map.keys()),\n\t};\n};\n\nconst renderTree = (toggleExpand: (node: Datum) => React.MouseEventHandler) =>\n\tfunction MareLineTreeNode(node: Datum) {\n\t\treturn (\n\t\t\t<TreeItem\n\t\t\t\tclassName={node.className}\n\t\t\t\tkey={node.id}\n\t\t\t\tnodeId={node.id}\n\t\t\t\tlabel={node.label}\n\t\t\t\tonIconClick={toggleExpand(node)}\n\t\t\t>\n\t\t\t\t{node.children.map(renderTree(toggleExpand))}\n\t\t\t</TreeItem>\n\t\t);\n\t};\n\nexport const MareLineTree: React.FC = function MareLineTree() {\n\tconst classes = useStyles();\n\tconst dispatch = useAppDispatch();\n\tconst [expanded, setExpanded] = useState<string[]>([]);\n\n\tconst defs = useAppSelector((state) => state.horseDefs.list);\n\tconst { nodes, ids } = useMemo(() => {\n\t\tif (defs.length > 0) {\n\t\t\treturn withIndicatorSync(dispatch)('mare-line/init')(() =>\n\t\t\t\tconstruct(defs)\n\t\t\t);\n\t\t} else {\n\t\t\treturn { nodes: [], ids: [] };\n\t\t}\n\t}, [dispatch, defs]);\n\n\tuseEffect(() => {\n\t\tsetExpanded(ids);\n\t}, [setExpanded, ids]);\n\n\tconst toggleExpand = useMemo<(node: Datum) => React.MouseEventHandler>(\n\t\t() => (node) => (_event) => {\n\t\t\tsetExpanded(\n\t\t\t\texpanded.includes(node.id)\n\t\t\t\t\t? expanded.filter((id) => id !== node.id)\n\t\t\t\t\t: [...expanded, node.id]\n\t\t\t);\n\t\t},\n\t\t[expanded, setExpanded]\n\t);\n\n\treturn (\n\t\t<React.Fragment>\n\t\t\t<TreeView\n\t\t\t\tclassName={classes.root}\n\t\t\t\texpanded={expanded}\n\t\t\t\tdefaultCollapseIcon={<ExpandMoreIcon />}\n\t\t\t\tdefaultExpandIcon={<ChevronRightIcon />}\n\t\t\t\tdefaultEndIcon={<RemoveIcon />}\n\t\t\t>\n\t\t\t\t{nodes.map(renderTree(toggleExpand))}\n\t\t\t</TreeView>\n\t\t</React.Fragment>\n\t);\n};\n","import * as React from 'react';\nimport { createStyles, Paper, Typography, makeStyles } from '@material-ui/core';\n\nimport { MareLineTree } from './MareLineTree';\n\nconst useStyles = makeStyles((theme) =>\n\tcreateStyles({\n\t\tpaper: {\n\t\t\tpadding: theme.spacing(2),\n\t\t},\n\t})\n);\n\nexport const MareLine: React.FC = () => {\n\tconst classes = useStyles();\n\treturn (\n\t\t<React.Fragment>\n\t\t\t<Typography variant=\"h4\">牝系図</Typography>\n\t\t\t<Paper className={classes.paper}>\n\t\t\t\t<MareLineTree />\n\t\t\t</Paper>\n\t\t</React.Fragment>\n\t);\n};\n"],"names":["useStyles","makeStyles","theme","createStyles","root","marginLeft","spacing","color","InformationIcon","name","dispatch","useAppDispatch","handleClick","useMemo","pedigreeActions","IconButton","size","onClick","InfoOutlined","fontSize","construct","defs","map","Map","fetchOrCreateNode","id","get","created","label","children","owned","set","forEach","def","node","className","sex","join","icon","faMars","faVenus","faQuestion","fatherName","motherName","setNodeProperty","push","nodes","Array","from","values","filter","value","has","ids","keys","renderTree","toggleExpand","TreeItem","nodeId","onIconClick","MareLineTree","classes","useState","expanded","setExpanded","useAppSelector","state","horseDefs","list","length","withIndicatorSync","useEffect","_event","includes","TreeView","defaultCollapseIcon","ExpandMore","defaultExpandIcon","ChevronRight","defaultEndIcon","Remove","paper","padding","MareLine","Typography","variant","Paper"],"sourceRoot":""}