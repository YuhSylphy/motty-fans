import{q as v,d as D,r as R}from"./store-B39U2sUK.js";import{r as m,j as e,R as S}from"./jsx-runtime-_5WuVDLK.js";import{D as T}from"./datetime-BT3pVNmC.js";import{T as J,I as E,u as w,G as u,f as $,a as F,b as z,d as U}from"./base-IEyfSv3Y.js";import{i as V,k as O,j as I,u as W,_ as G,b as L,c as N,h as q}from"./DefaultPropsProvider-Cd7czArd.js";import{P as g}from"./Paper-nIoFMWoM.js";import{C as Q}from"./Container-ZEU60_wJ.js";import{c as C}from"./menu-defs-CCPwfijY.js";import{u as Y,a as M}from"./ducks-D0Wyj6xE.js";import{L as K,T as a,a as X}from"./ListItem-DPIJrQSi.js";import{T as Z,D as ee,a as se,b as ne,c as H,d as h,e as te,A as ie,L as re}from"./TableRow-DHL9G5yA.js";import{I as oe}from"./IconButton-YPa5RDI0.js";import{B as k}from"./Box-_UgLl1y3.js";import{L as le}from"./Link-C5O9j2aB.js";import{f as ae,w as ce}from"./util-BN9zR8p4.js";import"./utils-BMjij2k7.js";import"./useTheme-gLwWT2hx.js";import"./TransitionGroupContext-DDXbBdsA.js";import"./index-CTAOeIM6.js";import"./useFormControl-gmeMoCWW.js";import"./useSlotProps-ARyd7VdJ.js";import"./Modal-C_0CZEdW.js";import"./Backdrop-CBRxG1rH.js";import"./GlobalStyles-Dcu5lQlt.js";import"./createBox-BG4Xlgkm.js";function de(s){return V("MuiTableHead",s)}O("MuiTableHead",["root"]);const ue=["className","component"],he=s=>{const{classes:n}=s;return q({root:["root"]},de,n)},me=I("thead",{name:"MuiTableHead",slot:"Root",overridesResolver:(s,n)=>n.root})({display:"table-header-group"}),xe={variant:"head"},y="thead",pe=m.forwardRef(function(n,i){const t=W({props:n,name:"MuiTableHead"}),{className:r,component:c=y}=t,o=G(t,ue),l=L({},t,{component:c}),x=he(l);return e.jsx(Z.Provider,{value:xe,children:e.jsx(me,L({as:c,className:N(x.root,r),ref:i,role:c===y?null:"rowgroup",ownerState:l},o))})}),je=C(e.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link"),fe=C(e.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),be=["video","broadcast","short"];function ve(s){return!!s&&be.includes(s)}function ge(s){if(!ve(s))return null;switch(s){case"video":return"動画";case"broadcast":return"生配信";case"short":return"ショート";default:throw Error(s)}}function B(){return e.jsx("div",{children:"Loading..."})}const _=s=>["★".repeat(s),"☆".repeat(5-s)].join("").trim();function A({thumbnail:{url:s,width:n,height:i},href:t,alt:r}){const c=w({xs:o=>({maxHeight:o.spacing(9)}),sm:o=>({maxHeight:o.spacing(9)}),md:o=>({maxHeight:o.spacing(6)}),lg:o=>({maxHeight:o.spacing(6)}),xl:o=>({maxHeight:o.spacing(6)})});return e.jsx(le,{href:t,sx:o=>({display:"flex",alignItems:"center",justifyContent:"center",...c(o)}),target:"_blank",rel:"noopener noreferrer",children:e.jsx(k,{component:"img",alt:r,src:s,sx:o=>({aspectRatio:`${n} / ${i}`,maxWidth:"100%",maxHeight:"100%",objectFit:"contain",display:"block"})})})}function P(s){const n=s.map(ge);switch(n.length){case 0:return null;case 1:return n[0];default:return n.map(i=>i==null?void 0:i.slice(0,1)).join(" / ")}}const Le=({styles:s,masteryLevel:n,part1:i,href:t})=>{const r=m.useMemo(()=>P(s),[s]),c=m.useMemo(()=>_(n),[n]),o=t!==null?{href:t,target:"_blank",rel:"noopener noreferrer"}:i!==null&&i.url!=null?{href:i.url,target:"_blank",rel:"noopener noreferrer"}:{};return{liveStyleLabel:r,masteryLevelLabel:c,iconButtonAdditionalProps:o}};function ye({id:s,platform:n,title:i,titleReleasedIn:t,styles:r,amount:c,masteryLevel:o,part1:l,remarks:x,href:d}){const{liveStyleLabel:p,masteryLevelLabel:f,iconButtonAdditionalProps:j}=Le({styles:r,masteryLevel:o,part1:l,href:d}),b=m.useCallback(()=>e.jsxs(u,{container:!0,children:[e.jsx(u,{item:!0,xs:6,children:e.jsx(a,{children:p})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(a,{children:f})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(a,{children:n})}),e.jsx(u,{item:!0,xs:6,children:e.jsxs(a,{children:["実況: ",(l==null?void 0:l.publishedIn)??"(未設定)"]})}),e.jsx(u,{item:!0,xs:6,children:e.jsxs(a,{children:["配信数: ",c]})}),e.jsx(u,{item:!0,xs:6,children:e.jsxs(a,{children:["発売: ",t??"(未設定)"]})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(a,{children:x})})]}),[p,f,n,l==null?void 0:l.publishedIn,c,t,x]);return e.jsx(X,{secondaryAction:e.jsx(oe,{edge:"end",...j,children:e.jsx(je,{})}),children:e.jsxs(u,{container:!0,children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(re,{primary:i})}),e.jsx(u,{item:!0,xs:4,children:l==null||!j.href?e.jsx(k,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:e.jsx(a,{children:"(未設定)"})}):e.jsx(A,{thumbnail:l.thumbnail,alt:l.title,...j})}),e.jsx(u,{item:!0,xs:8,children:e.jsx(b,{})})]})},s)}function Se({defs:s}){return e.jsx(g,{children:e.jsx(K,{sx:{width:"100%"},children:s.map(ye).flatMap((n,i)=>i===0?[n]:[e.jsx(ee,{variant:"inset",component:"li",sx:{marginLeft:0}},`divider-${i}`),n])})})}function Te({id:s,platform:n,title:i,titleReleasedIn:t,styles:r,amount:c,masteryLevel:o,part1:l,remarks:x,href:d},p){const f=m.useMemo(()=>P(r),[r]),j=m.useCallback(()=>l?e.jsx(h,{align:"center",sx:b=>({padding:`${b.spacing(.5)} ${b.spacing(2)}`}),children:e.jsx(A,{thumbnail:l.thumbnail,alt:i,href:d||l.url})}):e.jsx(h,{align:"center",children:e.jsx(a,{children:"(未設定)"})}),[l,i,d]);return e.jsxs(H,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(h,{component:"th",scope:"row",align:"center",children:e.jsx(a,{children:p+1})}),e.jsx(j,{}),e.jsx(h,{align:"center",children:e.jsx(a,{children:n})}),e.jsx(h,{children:e.jsx(a,{children:i})}),e.jsx(h,{align:"center",children:e.jsx(a,{children:(l==null?void 0:l.publishedIn)??"(未設定)"})}),e.jsx(h,{align:"center",children:e.jsx(a,{children:t??"(未設定)"})}),e.jsx(h,{align:"center",children:e.jsx(a,{children:f})}),e.jsx(h,{align:"center",children:e.jsx(a,{children:c})}),e.jsx(h,{align:"center",children:e.jsx(a,{children:_(o)})}),e.jsx(h,{children:e.jsx(a,{children:x})})]},s)}function we({defs:s}){return e.jsx(se,{component:g,children:e.jsxs(ne,{"aria-label":"simple table",children:[e.jsx(pe,{children:e.jsx(H,{children:["#","Part 1.","機種","タイトル","実況年","発売年","実況形式","実況本数","やりこみ評価","備考"].map((n,i)=>e.jsx(h,{component:"th",scope:"row",align:"center",children:n},i))})}),e.jsx(te,{children:s.map(Te)})]})})}function Ie(){return e.jsx(ie,{position:"static",color:"primary",enableColorOnDark:!0,children:e.jsx(a,{variant:"subtitle1",children:"MOTTYのゲーム実況シリーズ一覧"})})}const Ce=()=>{const{series:s}=M(t=>t.liveSeries),n=m.useMemo(()=>s.map(({id:t,game:r,seriesTitle:c,lives:o,remarks:l,videosHash:x})=>({id:t,platform:r==null?void 0:r.platform,title:c,titleReleasedIn:(r==null?void 0:r.releasedIn)||null,styles:(d=>Array.from(d))(o.map(({liveStyle:d})=>d).reduce((d,p)=>d.add(p),new Set)),amount:o.length,masteryLevel:r==null?void 0:r.masteryLevel,part1:o.length===0?null:o.slice(0,1).map(({publishedAt:d,url:p,thumbnail:f,title:j})=>({publishedIn:T.fromMillis(d,{zone:"JST"}).year,url:p,thumbnail:f,title:j}))[0],remarks:l,href:x?`/motty-fans/videos/${x}`:null})),[s]);return{viewMode:w({xs:"list",sm:"list",md:"table",lg:"table",xl:"table"}),defs:n}};function Me(){const{viewMode:s,defs:n}=Ce(),i=m.useCallback(()=>{switch(s){case"list":return e.jsx(Se,{defs:n});case"table":return e.jsx(we,{defs:n});default:throw s}},[s,n]);return e.jsxs(S.Fragment,{children:[e.jsx(Ie,{}),e.jsx(i,{})]})}const He=I(g)(({theme:s})=>({marginTop:s.spacing(1),marginBottom:s.spacing(1),padding:s.spacing(1)}));function ke(){return e.jsx(Q,{children:e.jsx(He,{children:e.jsx(J,{id:"live-series-condition-input",label:"find",InputProps:{startAdornment:e.jsx(E,{position:"start",children:e.jsx(fe,{})})},variant:"standard",fullWidth:!0})})})}const Be=()=>{const[s,n]=m.useState(!1),i=Y();m.useEffect(()=>{s||(i(v.init()),n(!0))},[s,n,i]);const{series:t}=M(c=>c.liveSeries);return{loading:m.useMemo(()=>!t||t.length===0,[t])}};function _e(){const{loading:s}=Be();return s?e.jsx(B,{}):e.jsxs(S.Fragment,{children:[e.jsx(ke,{}),e.jsx(Me,{})]})}function as(){return e.jsx(m.Suspense,{fallback:e.jsx(B,{}),children:e.jsx(_e,{})})}const Ae=({id:{videoId:s},snippet:{description:n,publishedAt:i,title:t,thumbnails:r},liveSeriesId:c,liveStyle:o,tags:l},x,d)=>({id:s,description:n,publishedAt:T.fromISO(i).toMillis(),title:t,thumbnail:r.default,liveSeriesId:c,liveStyle:o,tags:(l==null?void 0:l.map(U("none")))??[],url:`https://www.youtube.com/watch?v=${s}`});async function Pe(){const[s,n,i]=await Promise.all([(async()=>{const t=await $();return Object.groupBy(t.items.filter(({liveSeriesId:r})=>r!=null).map(Ae),({liveSeriesId:r})=>r??(()=>{throw new Error("unexpected video record having no live-series id")})())})(),(async()=>(await F()).items)(),(async()=>{const t=await z();return new Map(t.items.map(r=>[r.id,r]))})()]);return n.map(t=>({...t,lives:t.id in s?s[t.id]??[]:[],game:t.gameId&&i.has(t.gameId)?i.get(t.gameId)??null:null}))}const De=s=>s.pipe(ae(v.init.match),ce("live-series/init",async()=>{const n=await Pe();return v.setSeries({series:n})})),Re=D(De);R(Re);export{as as default};
