import{i as $,j,c as x,o as N,O as U,S as k,k as A,l as M,m as B,p as F,q as y,t as H}from"./store-CRWDXcVn.js";import{o as q}from"./hooks-DR2pew4s.js";var C=$(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function G(e,n){return new Promise(function(a,t){var c=new j({next:function(l){a(l),c.unsubscribe()},error:t,complete:function(){t(new C)}});e.subscribe(c)})}function I(e,n,a,t,c){return function(l,r){var i=a,o=n,s=0;l.subscribe(x(r,function(u){var b=s++;o=i?e(o,u,b):(i=!0,u)},function(){i&&r.next(o),r.complete()}))}}function E(e,n){return N(I(e,n,arguments.length>=2,!1,!0))}var O=function(e,n){return e.push(n),e};function P(){return N(function(e,n){E(O,[])(e).subscribe(n)})}function R(e,n,a,t){return N(function(c,l){var r;(!n||typeof n=="function")&&(r=n);var i=new Map,o=function(m){i.forEach(m),m(l)},s=function(m){return o(function(v){return v.error(m)})},u=0,b=!1,p=new U(l,function(m){try{var v=e(m),f=i.get(v);if(!f){i.set(v,f=t?t():new k);var d=S(v,f);if(l.next(d),a){var h=x(f,function(){f.complete(),h==null||h.unsubscribe()},void 0,void 0,function(){return i.delete(v)});p.add(A(a(d)).subscribe(h))}}f.next(r?r(m):m)}catch(g){s(g)}},function(){return o(function(m){return m.complete()})},s,function(){return i.clear()},function(){return b=!0,u===0});c.subscribe(p);function S(m,v){var f=new M(function(d){u++;var h=v.subscribe(d);return function(){h.unsubscribe(),--u===0&&b&&p.unsubscribe()}});return f.key=m,f}})}function T(e,n,a){var t=F(e)||n||a?{next:e,error:n,complete:a}:e;return t?N(function(c,l){var r;(r=t.subscribe)===null||r===void 0||r.call(t);var i=!0;c.subscribe(x(l,function(o){var s;(s=t.next)===null||s===void 0||s.call(t,o),l.next(o)},function(){var o;i=!1,(o=t.complete)===null||o===void 0||o.call(t),l.complete()},function(o){var s;i=!1,(s=t.error)===null||s===void 0||s.call(t,o),l.error(o)},function(){var o,s;i&&((o=t.unsubscribe)===null||o===void 0||o.call(t)),(s=t.finalize)===null||s===void 0||s.call(t)}))}):B}const K={Uk:{label:"不明(指定なし)"},Ec:{label:"エクリプス"},Ph:{label:"ファラリス"},Ns:{label:"ナスルーラ"},Ro:{label:"ロイヤルチャージャー"},Ne:{label:"ニアークティック"},Na:{label:"ネイティヴダンサー"},Fa:{label:"フェアウェイ"},To:{label:"トムフール"},Te:{label:"テディ"},Sw:{label:"スインフォード"},Ha:{label:"ハンプトン"},Hi:{label:"ヒムヤー"},St:{label:"セントサイモン"},Ma:{label:"マッチェム"},He:{label:"ヘロド"}},w=(e,{sex:n,listed:a,childName:t})=>{var u,b,p;const c=e.name??`${t}${n==="female"?"母":n==="male"?"父":"親"}`,l=e.name!==void 0,r=e.father?w(e.father,{sex:"male",childName:c}):[],i=e.mother?w(e.mother,{sex:"female",childName:c}):[],o=e.line??((u=r==null?void 0:r[0])==null?void 0:u.line)??"Uk";return[{name:c,line:o,listed:!!a,owned:!1,show:l,fatherName:(b=r==null?void 0:r[0])==null?void 0:b.name,motherName:(p=i==null?void 0:i[0])==null?void 0:p.name,memo:[],sex:n},r,i].flat()},z=()=>fetch("/motty-fans//assets/horse-defs.json").then(e=>e.json()).then(e=>e.filter(n=>!n.removed).map(n=>({...n,listed:!!n.listed,owned:!0,show:!0,memo:n.memo??[]}))),D=()=>fetch("/motty-fans//assets/broodmares.json").then(e=>e.json()).then(e=>e.map(n=>w(n,{sex:"female",listed:!0,childName:"N/A"})).flat()),L=()=>fetch("/motty-fans//assets/stallions.json").then(e=>e.json()).then(e=>e.map(n=>w(n,{sex:"male",listed:!0,childName:"N/A"})).flat()),Q=()=>G(q(z,L,D).pipe(y(e=>e()),H(),R(e=>e.name),y(e=>e.pipe(E((n,a)=>({name:n.name??a.name,sex:n.sex??a.sex,listed:n.listed||a.listed,show:n.show||a.show,owned:n.owned||a.owned,line:n.line==="Uk"?a.line:n.line,memo:[...n.memo,...a.memo],fatherName:n.fatherName??a.fatherName,motherName:n.motherName??a.motherName})))),P(),T(e=>{const n=new Map(e.map(t=>[t.name,t])),a=t=>{var c;if(!(t.line&&t.line!=="Uk")){if(t.fatherName){const l=n.get(t.fatherName);l?a(l):console.warn(`${t.fatherName}: father of ${t.name} doesnt exist in list`,t,n)}t.line=((c=n.get(t.fatherName||""))==null?void 0:c.line)??"Uk",t.line==="Uk"&&console.warn(`couldnt determine line of ${t.name}`)}};e.forEach(a)})));export{Q as f,K as l,T as t};
